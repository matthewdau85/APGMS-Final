Code export generated on 2025-11-25 18:47:42
============================================================
FILE: C:\src\apgms-final\.github\copilot-instructions.md
============================================================
# Copilot / AI assistant instructions for APGMS

Keep guidance short and actionable. When making changes, prefer small, testable commits and reference the files noted below.

Key concepts and architecture
- Monorepo managed with pnpm (see `package.json` and `pnpm-workspace.yaml`). Workspaces: `services/*`, `webapp`, `shared`, `worker`.
- API services are Fastify + Prisma (example: `services/api-gateway/src/app.ts`, `services/*/src`). Database models live in `shared/prisma/schema.prisma` and the Prisma client is exposed from `shared/src/db.ts` as `prisma` / `db`.
- Shared utilities (masking, helpers) live in `shared/src` and are imported with the `@apgms/*` path (e.g. `@apgms/shared`).
- Web frontend is a Vite + React/TS app in `webapp/` (entry: `webapp/src/main.tsx`, Playwright tests in `webapp/tests`).

Common developer workflows (commands you should use)
- Install and bootstrap: `pnpm install --frozen-lockfile` (corepack recommended).
- Build all packages: `pnpm -r build` (root `package.json` delegates to workspace scripts).
- Run all tests: `pnpm -r test`.
- Run webapp E2E locally: use `scripts/run-webapp-tests.ps1` which:
  - writes a `playwright.config.ts`, ensures `webapp/package.json` scripts (`dev`, `build`, `preview`) exist, installs deps and Playwright browsers, optionally starts `services/api-gateway` (dev) and runs `pnpm -r test`.
- Quick local dev: `pnpm -w exec playwright test` (root README shows examples) or `pnpm -w exec vite` inside `webapp` for dev server.
- Prisma DB tasks (run from repo root):
  - `pnpm --filter @apgms/shared exec prisma generate --schema prisma/schema.prisma` (db client)
  - `pnpm --filter @apgms/shared exec prisma migrate dev --schema prisma/schema.prisma` (local migrations)
  - `pnpm --filter @apgms/shared exec prisma migrate deploy --schema prisma/schema.prisma` (deploy)

Project-specific conventions and patterns
- Auth: services use a simple base64url-encoded JSON Bearer token for request principal. See `services/api-gateway/src/app.ts` (functions `extractPrincipal` and `PrincipalSchema`) for the exact shape: { id, orgId, role }.
- Admin operations use `ADMIN_TOKEN` environment variable and the header `x-admin-token` (see `requireAdmin`).
- Idempotency: POST /bank-lines supports `Idempotency-Key` header. The DB has a compound unique on `[orgId, idempotencyKey]` to dedupe requests (see `shared/prisma/schema.prisma` and `api-gateway` upsert logic).
- Error & secret handling: use `@apgms/shared/masking.ts` helpers (`maskObject`, `maskError`) before logging or returning structured errors.
- Database URL handling: `shared/src/db.ts` expects `DATABASE_URL` env var and throws if missing â€” when running services in dev ensure `.env` exists at repo root or set process envs. `services/api-gateway/src/index.ts` loads repo-root `.env`.

Integration points & external deps
- Postgres via `DATABASE_URL` (Prisma). See `shared/prisma/schema.prisma` for models.
- Playwright for E2E tests; Playwright browsers are installed by `pnpm exec playwright install --with-deps` (see `scripts/run-webapp-tests.ps1`).
- Docker: `docker-compose.yml` can bootstrap services for integration testing; root README suggests `docker compose up -d` after `pnpm -r build`.

Files to reference when changing behavior
- API routes and auth: `services/api-gateway/src/app.ts`, `services/*/src` for other services.
- DB client and models: `shared/src/db.ts`, `shared/prisma/schema.prisma`.
- Logging and masking: `shared/src/masking.ts`.
- E2E helper script: `scripts/run-webapp-tests.ps1` and `webapp/playwright.config.ts` (generated by the script).
- Workspace config: `package.json`, `pnpm-workspace.yaml`.

Examples (copy/paste ready)
- Start full dev & tests (Windows PS):
  pnpm install --frozen-lockfile; pnpm -r build; docker compose up -d; pnpm -r test
- Run webapp E2E with API start (PS):
  .\scripts\run-webapp-tests.ps1 -StartApi

When editing code
- Keep changes scoped to one package when possible and run that package's tests.
- If you change the Prisma schema, update `@apgms/shared` client: run `pnpm --filter @apgms/shared exec prisma generate --schema shared/prisma/schema.prisma` and run migrations locally (`migrate dev`) when appropriate.

What not to change without human review
- Global workspace scripts/CI, `pnpm-workspace.yaml`, and schema migrations that affect production data.

If anything here is unclear or you need more examples (tests to run, env values to set, or common developer mistakes to avoid), tell me which area to expand and I will iterate.



============================================================
FILE: C:\src\apgms-final\.github\dependabot.yml
============================================================
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    groups:
      dependencies:
        patterns:
          - "*"
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"



============================================================
FILE: C:\src\apgms-final\.github\workflows\backup.yml
============================================================
name: Evidence Backup

on:
  schedule:
    - cron: "30 2 * * *"
  workflow_dispatch:

jobs:
  backup:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v4
        with:
          version: 9

      - uses: actions/setup-node@v4
        with:
          node-version: "20.11.x"
          cache: "pnpm"
          cache-dependency-path: pnpm-lock.yaml

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Start API Gateway
        run: |
          pnpm --filter @apgms/api-gateway dev &
          echo $! > gateway.pid

      - name: Wait for readiness
        run: |
          for i in {1..30}; do
            if curl -sf http://localhost:3000/ready > /dev/null; then
              exit 0
            fi
            sleep 2
          done
          echo "API gateway failed to become ready" >&2
          kill $(cat gateway.pid)
          exit 1

      - name: Acquire JWT
        id: login
        run: |
          TOKEN=$(curl -sf -X POST http://localhost:3000/auth/login \
            -H 'Content-Type: application/json' \
            -d '{"email":"dev@example.com","password":"admin123"}' | jq -r '.token')
          if [ -z "$TOKEN" ] || [ "$TOKEN" = "null" ]; then
            echo "Failed to obtain token" >&2
            exit 1
          fi
          echo "token=$TOKEN" >> "$GITHUB_OUTPUT"

      - name: Generate evidence pack
        env:
          APGMS_API_TOKEN: ${{ steps.login.outputs.token }}
        run: |
          pnpm backup:evidence-pack -- \
            --base-url http://localhost:3000 \
            --org dev-org \
            --token "${APGMS_API_TOKEN}" \
            --out artifacts/evidence

      - name: Stop API Gateway
        if: always()
        run: kill $(cat gateway.pid) || true

      - name: Upload evidence artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: compliance-evidence-pack
          path: artifacts/evidence/*.json



============================================================
FILE: C:\src\apgms-final\.github\workflows\ci.yml
============================================================
name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v4
        with:
          version: 9

      - uses: actions/setup-node@v4
        with:
          node-version: '20.11.x'
          cache: 'pnpm'
          cache-dependency-path: pnpm-lock.yaml

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Install Playwright deps
        run: pnpm exec playwright install --with-deps

      # 1. Build all packages/workspaces so TS has generated types, Prisma clients, etc.
      - name: Build packages
        run: pnpm -r build

      # 2. ðŸ”’ Quality 3.1: enforce type safety in CI
      #    This is the "no merge with type errors" gate.
      - name: Typecheck
        run: pnpm -r typecheck

      # 3. Tests + coverage gate
      #    First run tests with coverage output...
      - name: Test (with coverage)
        run: pnpm -r test -- --coverage

      #    ...then enforce coverage budget (>=85% lines, etc.).
      #    check-coverage.mjs should read the coverage summary JSON and exit 1 if below threshold.
      - name: Enforce coverage >=85%
        run: |
          node ./scripts/check-coverage.mjs

      # 4. Bring up API gateway and perf smoke it with k6
      - name: Install k6
        uses: grafana/setup-k6@v1

      - name: Start API Gateway
        run: |
          pnpm --filter @apgms/api-gateway dev &
          echo $! > gateway.pid

      - name: Wait for API readiness
        run: |
          for i in {1..30}; do
            if curl -sf http://localhost:3000/ready > /dev/null; then
              exit 0
            fi
            sleep 2
          done
          echo "API gateway failed to become ready" >&2
          kill $(cat gateway.pid)
          exit 1

      - name: Run k6 smoke test
        run: pnpm k6:smoke -- --env BASE_URL=http://localhost:3000

      - name: Stop API Gateway
        if: always()
        run: kill $(cat gateway.pid) || true

      # 5. Schema / merge hygiene gates
      - name: Check Prisma migration drift
        run: pnpm -w exec prisma migrate status

      - name: Conflict marker guard
        run: git grep -n '<<<<<<<\|=======\|>>>>>>>' -- ':!*.lock'

      # 6. Secret scanning gate (Gitleaks)
      #    Fails the build if any API keys/tokens/secrets are committed.
      - name: Secret scan
        run: |
          curl -sSL https://github.com/gitleaks/gitleaks/releases/latest/download/gitleaks-linux-amd64 -o gitleaks
          chmod +x gitleaks
          ./gitleaks detect --no-color --redact --exit-code 1

  axe:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v4
        with:
          version: 9

      - uses: actions/setup-node@v4
        with:
          node-version: '20.11.x'
          cache: 'pnpm'
          cache-dependency-path: pnpm-lock.yaml

      - run: pnpm install --frozen-lockfile
      - run: pnpm exec playwright install --with-deps

      # Quick a11y smoke gate against critical UI (fast fail if it's totally broken)
      - name: A11y smoke
        run: pnpm -w exec playwright test webapp/tests/a11y.spec.ts

      # Full WCAG axe scan (per-route, attaches violations to CI artifacts)
      - run: pnpm --filter @apgms/webapp test:axe

  lighthouse:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v4
        with:
          version: 9

      - uses: actions/setup-node@v4
        with:
          node-version: '20.11.x'
        cache: 'pnpm'
        cache-dependency-path: pnpm-lock.yaml

      - run: pnpm install --frozen-lockfile
      - run: pnpm --filter @apgms/webapp build

      - name: Lighthouse CI
        uses: treosh/lighthouse-ci-action@v10
        with:
          configPath: ./lighthouserc.json
          runs: 1
          uploadArtifacts: true



============================================================
FILE: C:\src\apgms-final\.github\workflows\conflict-guard.yml
============================================================
name: Conflict Marker Guard

on:
  push:
    branches: [main]
  pull_request:
  workflow_dispatch:

jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check for conflict markers
        run: git grep -n '<<<<<<<\\|=======\\|>>>>>>>' -- ':!*.lock' && exit 1 || exit 0



============================================================
FILE: C:\src\apgms-final\.github\workflows\e2e.yml
============================================================
name: E2E
on: [workflow_dispatch]
jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with:
          version: 9
      - uses: actions/setup-node@v4
        with:
          node-version: '20.11.x'
          cache: 'pnpm'
      - run: pnpm i
      - run: docker compose up -d
      - run: pnpm -w exec playwright test



============================================================
FILE: C:\src\apgms-final\.github\workflows\nightly.yml
============================================================
name: Nightly Chaos Smoke

on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch:

jobs:
  chaos-smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with:
          version: 9
      - uses: actions/setup-node@v4
        with:
          node-version: "20.11.x"
          cache: "pnpm"
          cache-dependency-path: pnpm-lock.yaml
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      - name: Install Playwright deps
        run: pnpm exec playwright install --with-deps
      - name: Install k6
        uses: grafana/setup-k6@v1
      - name: Start API Gateway
        run: |
          pnpm --filter @apgms/api-gateway dev &
          echo $! > gateway.pid
      - name: Wait for readiness
        run: |
          for i in {1..30}; do
            if curl -sf http://localhost:3000/ready > /dev/null; then
              exit 0
            fi
            sleep 2
          done
          echo "API gateway failed to become ready" >&2
          kill $(cat gateway.pid)
          exit 1
      - name: Run compliance evidence (smoke focus)
        env:
          SKIP_K6: "true"
        run: pnpm compliance:evidence --tag nightly-$(date +%Y%m%d)
      - name: Run regulator portal smoke
        run: pnpm smoke:regulator
      - name: Run k6 chaos smoke
        run: pnpm k6:smoke -- --env BASE_URL=http://localhost:3000
      - name: Stop API Gateway
        if: always()
        run: kill $(cat gateway.pid) || true
      - name: Upload compliance artefacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: compliance-nightly
          path: artifacts/compliance/nightly-*.md



============================================================
FILE: C:\src\apgms-final\.github\workflows\python-tests.yml
============================================================
name: Python tests

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      - name: Install deps
        run: |
          python -m pip install -U pip
          pip install -r requirements.txt
      - name: Build normalized PAYG tables
        run: python tools/ato_scraper/normalize_payg_from_csvs.py
      - name: Run tests
        run: pytest -q



============================================================
FILE: C:\src\apgms-final\.github\workflows\security.yml
============================================================
name: Security Scans

on:
  schedule:
    - cron: '0 3 * * *'
  workflow_dispatch:
  push:
    paths:
      - '**/*.js'
      - '**/*.ts'
      - 'package.json'
      - 'pnpm-lock.yaml'
      - '.github/workflows/security.yml'

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with:
          version: 9
      - uses: actions/setup-node@v4
        with:
          node-version: '20.11.x'
          cache: 'pnpm'
          cache-dependency-path: pnpm-lock.yaml
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      - name: Dependency audit (high+)
        run: pnpm audit --audit-level high
      - name: Generate SBOM (CycloneDX)
        run: pnpm dlx @cyclonedx/cyclonedx-npm --output-format json --output-file sbom.json
      - name: Upload SBOM artifact
        uses: actions/upload-artifact@v4
        with:
          name: sbom-json
          path: sbom.json
      - name: Semgrep SAST
        uses: returntocorp/semgrep-action@v1
        with:
          config: "p/owasp-top-ten"
      - name: Gitleaks Secret Scan
        uses: gitleaks/gitleaks-action@v2
        with:
          args: --no-git --redact
      - name: Trivy FS Scan
        uses: aquasecurity/trivy-action@0.12.0
        with:
          scan-type: fs
          format: table
          severity: HIGH,CRITICAL
          ignore-unfixed: true
      - name: Prisma drift check
        run: pnpm --filter @apgms/shared exec prisma migrate status --schema prisma/schema.prisma
      - name: Header + Auth smoke tests
        run: |
          pnpm --filter @apgms/api-gateway exec tsx ./test/security.headers.spec.ts
          pnpm --filter @apgms/api-gateway exec tsx ./test/auth.guard.spec.ts



============================================================
FILE: C:\src\apgms-final\.github\workflows\supply-chain.yml
============================================================
name: Supply Chain & Security Scans

on:
  workflow_dispatch:
  push:
    branches: [main]
  pull_request:

jobs:
  sbom-and-audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
      - name: Install pnpm
        run: corepack enable
      - name: Install deps (root)
        run: pnpm install --frozen-lockfile
      - name: Generate SBOM (CycloneDX)
        run: pnpm dlx @cyclonedx/cyclonedx-npm --output-file sbom.xml
      - name: Upload SBOM
        uses: actions/upload-artifact@v4
        with:
          name: sbom
          path: sbom.xml
      - name: npm audit (high+)
        run: pnpm audit --audit-level=high
      - name: Store audit report
        if: always()
        run: pnpm audit --json > audit.json
      - name: Upload audit report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: audit-report
          path: audit.json

  gitleaks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan secrets with gitleaks
        uses: zricethezav/gitleaks-action@v2
        with:
          args: detect --source . --no-git



============================================================
FILE: C:\src\apgms-final\.github\workflows\trivy.yml
============================================================
name: Trivy Scan

on:
  workflow_dispatch:
  push:
    branches: [main]
  pull_request:

jobs:
  trivy-fs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Trivy
        uses: aquasecurity/trivy-action@0.21.0
        with:
          scan-type: 'fs'
          scan-ref: .
          ignore-unfixed: true
          vuln-type: 'os,library'
          severity: 'HIGH,CRITICAL'
          exit-code: '1'
      - name: Upload Trivy report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: trivy-report
          path: trivy-report.json



============================================================
FILE: C:\src\apgms-final\.github\workflows\verify-designated-reconciliation.yml
============================================================
name: Nightly Reconciliation Verification

on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch:

jobs:
  verify-reconciliation:
    runs-on: ubuntu-latest
    env:
      DATABASE_URL: ${{ secrets.DATABASE_URL }}
      # Ensure the worker DB and other secrets are set
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v3
        with:
          version: 9
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "pnpm"
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      - name: Run designated reconciliation verification
        run: pnpm --filter worker exec node scripts/verify-designated-reconciliation.mjs



============================================================
FILE: C:\src\apgms-final\20251101_add_payroll.sql
============================================================
-- Employees table
CREATE TABLE "Employee" (
  "id" TEXT PRIMARY KEY,
  "orgId" TEXT NOT NULL REFERENCES "Org"("id") ON DELETE CASCADE,
  "fullNameCiphertext" TEXT NOT NULL,
  "fullNameKid" TEXT NOT NULL,
  "tfnProvided" BOOLEAN NOT NULL DEFAULT false,
  "employmentType" TEXT NOT NULL, -- 'full_time' | 'part_time' | 'contractor' | etc.
  "baseRate" NUMERIC(12,2) NOT NULL DEFAULT 0, -- hourly or derived salary rate
  "superRate" NUMERIC(5,2) NOT NULL DEFAULT 11.0,
  "status" TEXT NOT NULL DEFAULT 'active',
  "createdAt" TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- PayRun table: e.g. "Fortnight ending 2025-11-14"
CREATE TABLE "PayRun" (
  "id" TEXT PRIMARY KEY,
  "orgId" TEXT NOT NULL REFERENCES "Org"("id") ON DELETE CASCADE,
  "periodStart" TIMESTAMP WITH TIME ZONE NOT NULL,
  "periodEnd" TIMESTAMP WITH TIME ZONE NOT NULL,
  "paymentDate" TIMESTAMP WITH TIME ZONE NOT NULL,
  "status" TEXT NOT NULL DEFAULT 'draft', -- 'draft' | 'committed'
  "createdAt" TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Payslip table: amounts per worker inside a run
CREATE TABLE "Payslip" (
  "id" TEXT PRIMARY KEY,
  "payRunId" TEXT NOT NULL REFERENCES "PayRun"("id") ON DELETE CASCADE,
  "employeeId" TEXT NOT NULL REFERENCES "Employee"("id") ON DELETE CASCADE,

  "grossPay" NUMERIC(12,2) NOT NULL,
  "paygWithheld" NUMERIC(12,2) NOT NULL,
  "superAccrued" NUMERIC(12,2) NOT NULL,

  "notesCiphertext" TEXT NOT NULL,
  "notesKid" TEXT NOT NULL,

  "createdAt" TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- helpful indexes
CREATE INDEX "Employee_orgId_idx" ON "Employee"("orgId");
CREATE INDEX "PayRun_orgId_idx" ON "PayRun"("orgId");
CREATE INDEX "Payslip_payRunId_idx" ON "Payslip"("payRunId");
CREATE INDEX "Payslip_employeeId_idx" ON "Payslip"("employeeId");



============================================================
FILE: C:\src\apgms-final\apps\phase1-demo\package.json
============================================================
{
  "name": "@apgms/phase1-demo",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "dev": "tsx src/index.ts",
    "build": "tsc -p tsconfig.json"
  },
  "dependencies": {
    "@apgms/ledger": "workspace:*",
    "@apgms/shared": "workspace:*",
    "@prisma/client": "^6.17.1",
    "fastify": "^5.6.1",
    "uuid": "^10.0.0"
  },
  "devDependencies": {
    "@types/uuid": "^11.0.0"
  }
}



============================================================
FILE: C:\src\apgms-final\apps\phase1-demo\src\index.ts
============================================================
import Fastify from "fastify";
import { AccountSubtype, AccountType, PrismaClient } from "@prisma/client";
import { v7 as uuidv7 } from "uuid";

import { JournalWriter } from "@apgms/ledger";
import type { BusEnvelope } from "@apgms/shared";
import { NatsBus } from "@apgms/shared";

const prisma = new PrismaClient();

const config = {
  port: Number(process.env.PORT ?? 3001),
  orgId: process.env.DEMO_ORG_ID ?? "11111111-1111-1111-1111-111111111111",
  natsUrl: process.env.NATS_URL ?? "nats://localhost:4222",
  natsStream: process.env.NATS_STREAM ?? "APGMS",
  subjectPrefix: process.env.NATS_SUBJECT_PREFIX ?? "apgms.dev",
  schemaVersion: "apgms.tax.v3",
};

const subjects = {
  payrollIngested: `${config.subjectPrefix}.payroll.ingested`,
  reconAlert: `${config.subjectPrefix}.recon.alert`,
};

const ledgerWriter = new JournalWriter(prisma);

async function main(): Promise<void> {
  const nats = await NatsBus.connect({
    url: config.natsUrl,
    stream: config.natsStream,
    subjectPrefix: config.subjectPrefix,
  });

  await ensureOrganization(config.orgId);
  const accounts = await ensureBaselineAccounts(config.orgId);

  await nats.subscribe(subjects.payrollIngested, "ledger-payroll", async (message) => {
    const payload = message.payload as PayrollPayload;
    const amount = BigInt(payload.paygwCents);

    await ledgerWriter.write({
      orgId: message.orgId,
      eventId: message.id,
      dedupeId: message.dedupeId,
      type: "PAYROLL_HOLD",
      occurredAt: new Date(message.ts),
      source: message.source,
      postings: [
        { accountId: accounts.paygwBuffer.id, amountCents: -amount },
        { accountId: accounts.clearing.id, amountCents: amount },
      ],
    });
  });

  if (process.env.DEMO_PUBLISH === "true") {
    await publishSyntheticPayroll(nats, subjects.payrollIngested, config.orgId);
  }

  const app = Fastify();

  app.get("/ready", async () => {
    await prisma.$queryRaw`SELECT 1`;
    await nats.ping();
    return { ok: true };
  });

  app.get<{
    Params: { code: string };
  }>("/balances/:code", async (request, reply) => {
    const { code } = request.params;
    const account = await prisma.account.findFirst({ where: { orgId: config.orgId, code } });
    if (!account) {
      reply.code(404).send({ error: "account not found" });
      return;
    }

    const aggregate = await prisma.posting.aggregate({
      where: { orgId: config.orgId, accountId: account.id },
      _sum: { amountCents: true },
    });

    reply.send({
      account: code,
      balanceCents: (aggregate._sum.amountCents ?? 0n).toString(),
    });
  });

  const address = await app.listen({ port: config.port, host: "0.0.0.0" });
  // eslint-disable-next-line no-console
  console.log(`Phase 1 demo listening on ${address}`);

  const shutdown = async () => {
    await app.close();
    await nats.close();
    await prisma.$disconnect();
    process.exit(0);
  };

  process.on("SIGINT", () => void shutdown());
  process.on("SIGTERM", () => void shutdown());
}

main().catch(async (error) => {
  // eslint-disable-next-line no-console
  console.error("Phase 1 demo failed", error);
  await prisma.$disconnect();
  process.exit(1);
});

type PayrollPayload = {
  payrollId: string;
  paygwCents: number;
  grossCents: number;
};

async function publishSyntheticPayroll(bus: NatsBus, subject: string, orgId: string): Promise<void> {
  const envelope: BusEnvelope<PayrollPayload> = {
    id: uuidv7(),
    orgId,
    eventType: "payroll.ingested",
    key: orgId,
    ts: new Date().toISOString(),
    schemaVersion: config.schemaVersion,
    source: "adapter/payroll",
    dedupeId: uuidv7(),
    payload: {
      payrollId: uuidv7(),
      grossCents: 8_500_00,
      paygwCents: 1_700_00,
    },
  };

  await bus.publish(subject, envelope);
}

async function ensureOrganization(orgId: string): Promise<void> {
  await prisma.organization.upsert({
    where: { id: orgId },
    update: {},
    create: { id: orgId, name: "APGMS Demo Org" },
  });
}

async function ensureBaselineAccounts(orgId: string) {
  const codes = [
    { code: "1000", name: "BANK:Operating", type: AccountType.ASSET, subtype: AccountSubtype.BANK },
    {
      code: "2000",
      name: "LIABILITY:PAYGW_BUFFER",
      type: AccountType.LIABILITY,
      subtype: AccountSubtype.PAYGW_BUFFER,
    },
    {
      code: "2100",
      name: "LIABILITY:GST_BUFFER",
      type: AccountType.LIABILITY,
      subtype: AccountSubtype.GST_BUFFER,
    },
    {
      code: "2200",
      name: "LIABILITY:CLEARING:BAS",
      type: AccountType.LIABILITY,
      subtype: AccountSubtype.CLEARING,
    },
    { code: "9999", name: "SUSPENSE:RECON", type: AccountType.EXPENSE, subtype: AccountSubtype.SUSPENSE },
  ];

  const records = await Promise.all(
    codes.map(async (entry) =>
      prisma.account.upsert({
        where: { orgId_code: { orgId, code: entry.code } },
        update: {},
        create: {
          orgId,
          code: entry.code,
          name: entry.name,
          type: entry.type,
          subtype: entry.subtype,
        },
      }),
    ),
  );

  return {
    bank: records[0],
    paygwBuffer: records[1],
    gstBuffer: records[2],
    clearing: records[3],
    suspense: records[4],
  };
}



============================================================
FILE: C:\src\apgms-final\apps\phase1-demo\src\prisma-shim.d.ts
============================================================
// apps/phase1-demo/src/prisma-shim.d.ts
// Lightweight shim so the demo app can compile even if these
// types aren't generated by the current Prisma schema.

declare module "@prisma/client" {
  /**
   * Minimal PrismaClient shape to satisfy JournalWriter's PrismaJournalClient.
   * Runtime still uses the real Prisma client from node_modules; this is
   * only about TypeScript seeing the right structure.
   */
  export class PrismaClient {
    journal: {
      findFirst(args: any): Promise<any>;
      create(args: any): Promise<any>;
    };

    $transaction<T>(fn: (tx: PrismaClient) => Promise<T>): Promise<T>;

    // Allow any other properties/methods without strict typing.
    [key: string]: any;
  }

  /**
   * AccountType/AccountSubtype as both values and types so you can write:
   *   type: AccountType.ASSET
   *   subtype: AccountSubtype.BANK
   */

  export const AccountType: {
    ASSET: "ASSET";
    LIABILITY: "LIABILITY";
    EXPENSE: "EXPENSE";
  };

  export type AccountType = (typeof AccountType)[keyof typeof AccountType];

  export const AccountSubtype: {
    BANK: "BANK";
    PAYGW_BUFFER: "PAYGW_BUFFER";
    GST_BUFFER: "GST_BUFFER";
    CLEARING: "CLEARING";
    SUSPENSE: "SUSPENSE";
  };

  export type AccountSubtype = (typeof AccountSubtype)[keyof typeof AccountSubtype];
}



============================================================
FILE: C:\src\apgms-final\apps\phase1-demo\src\types\uuid.d.ts
============================================================
declare module "uuid";



============================================================
FILE: C:\src\apgms-final\apps\phase1-demo\tsconfig.json
============================================================
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    // Make the "root" of this project the monorepo root so that
    // imports resolved via @apgms/shared (../../shared/src) are
    // considered inside the project and don't trigger TS6059.
    "rootDir": "../..",

    // We only want phase1-demo to type-check; the main build
    // artefacts come from the other packages (shared, api-gateway, webapp, etc.)
    // so don't emit JS for this app.
    "noEmit": true
  },
  "include": [
    "src"
  ]
}



============================================================
FILE: C:\src\apgms-final\artifacts\compliance\local-20250223.md
============================================================
# Compliance Evidence

- Timestamp: 2025-10-23T20:29:06.281Z
- Git commit: d31ca06a810bf745ba579e56ee4ccf011b255e58
- Tag: local-20250223
- Base URL: http://localhost:3000
- Skip k6: false

## pnpm -r test

- Exit code: 0

```text
Scope: 4 of 5 workspace projects
worker test$ echo test worker
webapp test$ playwright test
worker test: test worker
worker test: Done
webapp test: [2m[WebServer] [22m
webapp test: [2m[WebServer] [22m> @apgms/webapp@0.1.0 dev C:\src\APGMS-Final\APGMS-Final\webapp
webapp test: [2m[WebServer] [22m> vite "--port" "5173"
webapp test: [2m[WebServer] [22m
webapp test: [2m[WebServer] [22m
webapp test: [2m[WebServer] [22m  [32m[1mVITE[22m v5.4.21[39m  [2mready in [0m[1m495[22m[2m[0m ms[22m
webapp test: [2m[WebServer] [22m
webapp test: [2m[WebServer] [22m  [32mâžœ[39m  [1mLocal[22m:   [36mhttp://localhost:[1m5173[22m/[39m
webapp test: [2m[WebServer] [22m  [32mâžœ[39m  [1mNetwork[22m: [36mhttp://172.27.80.1:[1m5173[22m/[39m
webapp test: [2m[WebServer] [22m  [32mâžœ[39m  [1mNetwork[22m: [36mhttp://192.168.208.170:[1m5173[22m/[39m
webapp test: Running 4 tests using 2 workers
webapp test:   ok 1 [chromium] â€º tests\axe.spec.ts:8:5 â€º Accessibility for / â€º should have no detectable Axe violations on / (2.7s)
webapp test:   ok 2 [chromium] â€º tests\a11y.spec.ts:8:5 â€º Accessibility regression checks â€º ensures / meets WCAG 2.1 AA requirements (2.7s)
webapp test:   ok 4 [chromium] â€º tests\axe.spec.ts:8:5 â€º Accessibility for /bank-lines â€º should have no detectable Axe violations on /bank-lines (2.3s)
webapp test:   ok 3 [chromium] â€º tests\a11y.spec.ts:8:5 â€º Accessibility regression checks â€º ensures /bank-lines meets WCAG 2.1 AA requirements (2.3s)
webapp test:   4 passed (9.3s)
webapp test: Done
services/api-gateway test$ tsx --test test/run.ts
services/api-gateway test: TAP version 13
services/api-gateway test: # Subtest: POST /admin/data/delete
services/api-gateway test:     # Subtest: returns 401 without bearer token
services/api-gateway test:     ok 1 - returns 401 without bearer token
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 73.749
services/api-gateway test:       ...
services/api-gateway test:     # Subtest: rejects non-admin principals
services/api-gateway test:     ok 2 - rejects non-admin principals
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 8.2014
services/api-gateway test:       ...
services/api-gateway test:     # Subtest: validates confirm token
services/api-gateway test:     ok 3 - validates confirm token
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 11.0832
services/api-gateway test:       ...
services/api-gateway test:     # Subtest: returns 404 for unknown subject
services/api-gateway test:     ok 4 - returns 404 for unknown subject
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 18.8911
services/api-gateway test:       ...
services/api-gateway test:     # Subtest: anonymizes user with constraint risk
services/api-gateway test:     ok 5 - anonymizes user with constraint risk
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 253.9234
services/api-gateway test:       ...
services/api-gateway test:     # Subtest: hard deletes user when no constraint risk
services/api-gateway test:     ok 6 - hard deletes user when no constraint risk
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 14.1647
services/api-gateway test:       ...
services/api-gateway test:     1..6
services/api-gateway test: ok 1 - POST /admin/data/delete
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 382.4402
services/api-gateway test:   type: 'suite'
services/api-gateway test:   ...
services/api-gateway test: # Subtest: 401 without token
services/api-gateway test: ok 2 - 401 without token
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 12.2886
services/api-gateway test:   ...
services/api-gateway test: # Subtest: 403 when principal is not admin
services/api-gateway test: ok 3 - 403 when principal is not admin
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 6.5211
services/api-gateway test:   ...
services/api-gateway test: # Subtest: 404 when subject is missing
services/api-gateway test: ok 4 - 404 when subject is missing
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 6.351
services/api-gateway test:   ...
services/api-gateway test: # Subtest: 200 returns expected export bundle
services/api-gateway test: ok 5 - 200 returns expected export bundle
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 10.2317
services/api-gateway test:   ...
services/api-gateway test: # Subtest: loadConfig parses typed values and defaults
services/api-gateway test: ok 6 - loadConfig parses typed values and defaults
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 4.715
services/api-gateway test:   ...
services/api-gateway test: # Subtest: loadConfig fails closed when secrets missing
services/api-gateway test: ok 7 - loadConfig fails closed when secrets missing
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 1.0043
services/api-gateway test:   ...
services/api-gateway test: # Subtest: ABN validation
services/api-gateway test:     # Subtest: accepts known valid ABNs
services/api-gateway test:     ok 1 - accepts known valid ABNs
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 0.6469
services/api-gateway test:       ...
services/api-gateway test:     # Subtest: rejects invalid ABNs
services/api-gateway test:     ok 2 - rejects invalid ABNs
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 0.3152
services/api-gateway test:       ...
services/api-gateway test:     1..2
services/api-gateway test: ok 8 - ABN validation
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 1.1273
services/api-gateway test:   type: 'suite'
services/api-gateway test:   ...
services/api-gateway test: # Subtest: TFN handling
services/api-gateway test:     # Subtest: never exposes the original TFN
services/api-gateway test:     ok 1 - never exposes the original TFN
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 11.6774
services/api-gateway test:       ...
services/api-gateway test:     1..1
services/api-gateway test: ok 9 - TFN handling
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 11.8129
services/api-gateway test:   type: 'suite'
services/api-gateway test:   ...
services/api-gateway test: # Subtest: admin decryption
services/api-gateway test:     # Subtest: emits an audit event when decryption succeeds
services/api-gateway test:     ok 1 - emits an audit event when decryption succeeds
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 8.4679
services/api-gateway test:       ...
services/api-gateway test:     # Subtest: denies non-admin access
services/api-gateway test:     ok 2 - denies non-admin access
services/api-gateway test:       ---
services/api-gateway test:       duration_ms: 12.933
services/api-gateway test:       ...
services/api-gateway test:     1..2
services/api-gateway test: ok 10 - admin decryption
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 21.8016
services/api-gateway test:   type: 'suite'
services/api-gateway test:   ...
services/api-gateway test: # Subtest: Privacy integration suite requires RUN_PRIVACY_SUITE=true
services/api-gateway test: ok 11 - Privacy integration suite requires RUN_PRIVACY_SUITE=true # SKIP
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 1.1497
services/api-gateway test:   ...
services/api-gateway test: # Subtest: Readiness integration test requires RUN_READY_SUITE=true
services/api-gateway test: ok 12 - Readiness integration test requires RUN_READY_SUITE=true # SKIP
services/api-gateway test:   ---
services/api-gateway test:   duration_ms: 0.1076
services/api-gateway test:   ...
services/api-gateway test: 1..12
services/api-gateway test: # tests 19
services/api-gateway test: # suites 4
services/api-gateway test: # pass 17
services/api-gateway test: # fail 0
services/api-gateway test: # cancelled 0
services/api-gateway test: # skipped 2
services/api-gateway test: # todo 0
services/api-gateway test: # duration_ms 2320.5766
services/api-gateway test: Done
```

## pnpm -r typecheck

- Exit code: 0

```text
Scope: 4 of 5 workspace projects
shared typecheck$ tsc --noEmit -p tsconfig.json
worker typecheck$ echo no typecheck for worker
webapp typecheck$ tsc --noEmit
worker typecheck: no typecheck for worker
worker typecheck: Done
shared typecheck: Done
webapp typecheck: Done
services/api-gateway typecheck$ tsc --noEmit
services/api-gateway typecheck: Done
```

## pnpm --filter @apgms/shared exec prisma migrate status --schema prisma/schema.prisma

- Exit code: 0

```text
Prisma schema loaded from prisma\schema.prisma
Datasource "db": PostgreSQL database "apgms", schema "public" at "127.0.0.1:5432"

6 migrations found in prisma/migrations

Database schema is up to date!
```

## pnpm k6:smoke -- --env BASE_URL=http://localhost:3000

- Exit code: 4294967295

```text
> apgms@0.1.0 k6:smoke C:\src\APGMS-Final\APGMS-Final
> pnpm exec k6 run k6/smoke.js "--" "--env" "BASE_URL=http://localhost:3000"

â€‰ELIFECYCLEâ€‰ Command failed with exit code 4294967295.
```

```text
time="2025-10-24T06:29:30+10:00" level=error msg="accepts 1 arg(s), received 3: arg should either be \"-\", if reading script from stdin, or a path to a script file"
```




============================================================
FILE: C:\src\apgms-final\CONTRIBUTING.md
============================================================
# Contributing



============================================================
FILE: C:\src\apgms-final\coverage\coverage-final.json
============================================================
{"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\designated-accounts.ts": {"path":"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\designated-accounts.ts","statementMap":{"0":{"start":{"line":74,"column":34},"end":{"line":74,"column":41}},"1":{"start":{"line":75,"column":56},"end":{"line":75,"column":61}},"2":{"start":{"line":77,"column":13},"end":{"line":77,"column":26}},"3":{"start":{"line":80,"column":23},"end":{"line":80,"column":24}},"4":{"start":{"line":81,"column":21},"end":{"line":81,"column":25}},"5":{"start":{"line":83,"column":2},"end":{"line":91,"column":3}},"6":{"start":{"line":84,"column":4},"end":{"line":86,"column":7}},"7":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"8":{"start":{"line":89,"column":6},"end":{"line":89,"column":47}},"9":{"start":{"line":93,"column":21},"end":{"line":93,"column":44}},"10":{"start":{"line":96,"column":2},"end":{"line":101,"column":3}},"11":{"start":{"line":97,"column":4},"end":{"line":100,"column":7}},"12":{"start":{"line":104,"column":19},"end":{"line":104,"column":52}},"13":{"start":{"line":106,"column":2},"end":{"line":120,"column":3}},"14":{"start":{"line":107,"column":21},"end":{"line":115,"column":6}},"15":{"start":{"line":117,"column":4},"end":{"line":119,"column":5}},"16":{"start":{"line":118,"column":6},"end":{"line":118,"column":39}},"17":{"start":{"line":123,"column":2},"end":{"line":132,"column":5}},"18":{"start":{"line":134,"column":2},"end":{"line":139,"column":4}},"19":{"start":{"line":172,"column":21},"end":{"line":172,"column":55}},"20":{"start":{"line":174,"column":51},"end":{"line":179,"column":4}},"21":{"start":{"line":182,"column":17},"end":{"line":182,"column":37}},"22":{"start":{"line":184,"column":2},"end":{"line":184,"column":41}}},"fnMap":{"0":{"name":"applyDesignatedAccountTransfer","decl":{"start":{"line":70,"column":22},"end":{"line":70,"column":52}},"loc":{"start":{"line":72,"column":37},"end":{"line":140,"column":1}}},"1":{"name":"generateDesignatedAccountReconciliationArtifact","decl":{"start":{"line":169,"column":22},"end":{"line":169,"column":69}},"loc":{"start":{"line":170,"column":11},"end":{"line":185,"column":1}}}},"branchMap":{"0":{"loc":{"start":{"line":83,"column":2},"end":{"line":91,"column":3}},"type":"if","locations":[{"start":{"line":83,"column":2},"end":{"line":91,"column":3}}]},"1":{"loc":{"start":{"line":88,"column":4},"end":{"line":90,"column":5}},"type":"if","locations":[{"start":{"line":88,"column":4},"end":{"line":90,"column":5}}]},"2":{"loc":{"start":{"line":88,"column":8},"end":{"line":88,"column":42}},"type":"binary-expr","locations":[{"start":{"line":88,"column":8},"end":{"line":88,"column":15}},{"start":{"line":88,"column":19},"end":{"line":88,"column":42}}]},"3":{"loc":{"start":{"line":96,"column":2},"end":{"line":101,"column":3}},"type":"if","locations":[{"start":{"line":96,"column":2},"end":{"line":101,"column":3}}]},"4":{"loc":{"start":{"line":106,"column":2},"end":{"line":120,"column":3}},"type":"if","locations":[{"start":{"line":106,"column":2},"end":{"line":120,"column":3}}]},"5":{"loc":{"start":{"line":113,"column":17},"end":{"line":113,"column":36}},"type":"binary-expr","locations":[{"start":{"line":113,"column":17},"end":{"line":113,"column":24}},{"start":{"line":113,"column":28},"end":{"line":113,"column":36}}]},"6":{"loc":{"start":{"line":117,"column":4},"end":{"line":119,"column":5}},"type":"if","locations":[{"start":{"line":117,"column":4},"end":{"line":119,"column":5}}]}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0},"f":{"0":0,"1":0},"b":{"0":[0],"1":[0],"2":[0,0],"3":[0],"4":[0],"5":[0,0],"6":[0]}}
,"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\au-tax\\paygw-engine.ts": {"path":"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\au-tax\\paygw-engine.ts","statementMap":{"0":{"start":{"line":43,"column":31},"end":{"line":43,"column":62}},"1":{"start":{"line":48,"column":54},"end":{"line":48,"column":59}},"2":{"start":{"line":50,"column":19},"end":{"line":54,"column":6}},"3":{"start":{"line":56,"column":24},"end":{"line":56,"column":54}},"4":{"start":{"line":58,"column":25},"end":{"line":60,"column":null}},"5":{"start":{"line":63,"column":4},"end":{"line":67,"column":5}},"6":{"start":{"line":64,"column":6},"end":{"line":66,"column":8}},"7":{"start":{"line":69,"column":20},"end":{"line":69,"column":54}},"8":{"start":{"line":70,"column":29},"end":{"line":70,"column":67}},"9":{"start":{"line":72,"column":4},"end":{"line":76,"column":6}},"10":{"start":{"line":80,"column":18},"end":{"line":80,"column":39}},"11":{"start":{"line":81,"column":4},"end":{"line":83,"column":5}},"12":{"start":{"line":82,"column":6},"end":{"line":82,"column":71}},"13":{"start":{"line":84,"column":4},"end":{"line":84,"column":17}},"14":{"start":{"line":92,"column":16},"end":{"line":92,"column":18}},"15":{"start":{"line":93,"column":4},"end":{"line":99,"column":5}},"16":{"start":{"line":93,"column":17},"end":{"line":93,"column":18}},"17":{"start":{"line":94,"column":6},"end":{"line":98,"column":7}},"18":{"start":{"line":95,"column":8},"end":{"line":95,"column":18}},"19":{"start":{"line":97,"column":8},"end":{"line":97,"column":14}},"20":{"start":{"line":100,"column":4},"end":{"line":100,"column":17}},"21":{"start":{"line":104,"column":24},"end":{"line":104,"column":72}},"22":{"start":{"line":107,"column":30},"end":{"line":108,"column":null}},"23":{"start":{"line":111,"column":27},"end":{"line":111,"column":75}},"24":{"start":{"line":115,"column":4},"end":{"line":115,"column":39}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":43,"column":2},"end":{"line":43,"column":31}},"loc":{"start":{"line":43,"column":62},"end":{"line":43,"column":66}}},"1":{"name":"(anonymous_1)","decl":{"start":{"line":45,"column":2},"end":{"line":45,"column":7}},"loc":{"start":{"line":46,"column":32},"end":{"line":77,"column":3}}},"2":{"name":"(anonymous_2)","decl":{"start":{"line":79,"column":10},"end":{"line":79,"column":27}},"loc":{"start":{"line":79,"column":43},"end":{"line":85,"column":3}}},"3":{"name":"(anonymous_3)","decl":{"start":{"line":87,"column":10},"end":{"line":87,"column":26}},"loc":{"start":{"line":89,"column":22},"end":{"line":101,"column":3}}},"4":{"name":"(anonymous_4)","decl":{"start":{"line":103,"column":10},"end":{"line":103,"column":22}},"loc":{"start":{"line":103,"column":64},"end":{"line":116,"column":3}}}},"branchMap":{"0":{"loc":{"start":{"line":63,"column":4},"end":{"line":67,"column":5}},"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":67,"column":5}}]},"1":{"loc":{"start":{"line":81,"column":4},"end":{"line":83,"column":5}},"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":83,"column":5}}]},"2":{"loc":{"start":{"line":81,"column":8},"end":{"line":81,"column":54}},"type":"binary-expr","locations":[{"start":{"line":81,"column":8},"end":{"line":81,"column":20}},{"start":{"line":81,"column":24},"end":{"line":81,"column":54}}]},"3":{"loc":{"start":{"line":94,"column":6},"end":{"line":98,"column":7}},"type":"if","locations":[{"start":{"line":94,"column":6},"end":{"line":98,"column":7}},{"start":{"line":96,"column":13},"end":{"line":98,"column":7}}]}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0},"b":{"0":[0],"1":[0],"2":[0,0],"3":[0,0]}}
,"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\au-tax\\prisma-repository.ts": {"path":"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\au-tax\\prisma-repository.ts","statementMap":{"0":{"start":{"line":27,"column":4},"end":{"line":27,"column":25}},"1":{"start":{"line":36,"column":4},"end":{"line":44,"column":6}},"2":{"start":{"line":46,"column":4},"end":{"line":48,"column":6}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":26,"column":2},"end":{"line":26,"column":14}},"loc":{"start":{"line":26,"column":34},"end":{"line":28,"column":3}}},"1":{"name":"(anonymous_1)","decl":{"start":{"line":30,"column":2},"end":{"line":30,"column":7}},"loc":{"start":{"line":34,"column":3},"end":{"line":49,"column":3}}}},"branchMap":{},"s":{"0":0,"1":0,"2":0},"f":{"0":0,"1":0},"b":{}}
,"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\au-tax\\types.ts": {"path":"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\au-tax\\types.ts","statementMap":{"0":{"start":{"line":5,"column":0},"end":{"line":5,"column":null}},"1":{"start":{"line":6,"column":2},"end":{"line":6,"column":null}},"2":{"start":{"line":7,"column":2},"end":{"line":7,"column":null}},"3":{"start":{"line":8,"column":2},"end":{"line":8,"column":null}},"4":{"start":{"line":9,"column":2},"end":{"line":9,"column":null}},"5":{"start":{"line":10,"column":2},"end":{"line":10,"column":null}},"6":{"start":{"line":11,"column":2},"end":{"line":11,"column":null}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":5,"column":0},"end":{"line":5,"column":6}},"loc":{"start":{"line":5,"column":19},"end":{"line":12,"column":1}}}},"branchMap":{"0":{"loc":{"start":{"line":5,"column":12},"end":{"line":5,"column":null}},"type":"binary-expr","locations":[{"start":{"line":5,"column":12},"end":{"line":5,"column":19}},{"start":{"line":5,"column":12},"end":{"line":5,"column":null}}]}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"f":{"0":0},"b":{"0":[0,0]}}
,"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\designated-accounts\\guards.ts": {"path":"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\designated-accounts\\guards.ts","statementMap":{"0":{"start":{"line":9,"column":0},"end":{"line":9,"column":null}},"1":{"start":{"line":10,"column":2},"end":{"line":10,"column":null}},"2":{"start":{"line":11,"column":2},"end":{"line":11,"column":null}},"3":{"start":{"line":12,"column":2},"end":{"line":12,"column":null}},"4":{"start":{"line":25,"column":4},"end":{"line":25,"column":19}},"5":{"start":{"line":26,"column":4},"end":{"line":26,"column":45}},"6":{"start":{"line":41,"column":46},"end":{"line":41,"column":54}},"7":{"start":{"line":43,"column":2},"end":{"line":47,"column":3}},"8":{"start":{"line":44,"column":4},"end":{"line":46,"column":6}},"9":{"start":{"line":49,"column":2},"end":{"line":56,"column":3}},"10":{"start":{"line":53,"column":4},"end":{"line":55,"column":6}},"11":{"start":{"line":58,"column":2},"end":{"line":65,"column":3}},"12":{"start":{"line":62,"column":4},"end":{"line":64,"column":6}},"13":{"start":{"line":67,"column":2},"end":{"line":71,"column":3}},"14":{"start":{"line":68,"column":4},"end":{"line":70,"column":6}},"15":{"start":{"line":82,"column":2},"end":{"line":82,"column":65}},"16":{"start":{"line":92,"column":2},"end":{"line":103,"column":3}},"17":{"start":{"line":98,"column":6},"end":{"line":98,"column":13}},"18":{"start":{"line":100,"column":6},"end":{"line":102,"column":8}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":9,"column":0},"end":{"line":9,"column":6}},"loc":{"start":{"line":9,"column":38},"end":{"line":13,"column":1}}},"1":{"name":"(anonymous_1)","decl":{"start":{"line":24,"column":2},"end":{"line":24,"column":14}},"loc":{"start":{"line":24,"column":29},"end":{"line":27,"column":3}}},"2":{"name":"assertDesignatedAccountMovementAllowed","decl":{"start":{"line":38,"column":16},"end":{"line":38,"column":54}},"loc":{"start":{"line":39,"column":37},"end":{"line":72,"column":1}}},"3":{"name":"isActiveForNewDesignations","decl":{"start":{"line":79,"column":16},"end":{"line":79,"column":42}},"loc":{"start":{"line":80,"column":28},"end":{"line":83,"column":1}}},"4":{"name":"assertDesignatedAccountTypeIsSupported","decl":{"start":{"line":89,"column":16},"end":{"line":89,"column":54}},"loc":{"start":{"line":90,"column":28},"end":{"line":104,"column":1}}}},"branchMap":{"0":{"loc":{"start":{"line":9,"column":12},"end":{"line":9,"column":null}},"type":"binary-expr","locations":[{"start":{"line":9,"column":12},"end":{"line":9,"column":38}},{"start":{"line":9,"column":12},"end":{"line":9,"column":null}}]},"1":{"loc":{"start":{"line":43,"column":2},"end":{"line":47,"column":3}},"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":47,"column":3}}]},"2":{"loc":{"start":{"line":49,"column":2},"end":{"line":56,"column":3}},"type":"if","locations":[{"start":{"line":49,"column":2},"end":{"line":56,"column":3}}]},"3":{"loc":{"start":{"line":50,"column":4},"end":{"line":51,"column":71}},"type":"binary-expr","locations":[{"start":{"line":50,"column":4},"end":{"line":50,"column":59}},{"start":{"line":51,"column":4},"end":{"line":51,"column":71}}]},"4":{"loc":{"start":{"line":58,"column":2},"end":{"line":65,"column":3}},"type":"if","locations":[{"start":{"line":58,"column":2},"end":{"line":65,"column":3}}]},"5":{"loc":{"start":{"line":59,"column":4},"end":{"line":60,"column":52}},"type":"binary-expr","locations":[{"start":{"line":59,"column":4},"end":{"line":59,"column":63}},{"start":{"line":60,"column":4},"end":{"line":60,"column":52}}]},"6":{"loc":{"start":{"line":67,"column":2},"end":{"line":71,"column":3}},"type":"if","locations":[{"start":{"line":67,"column":2},"end":{"line":71,"column":3}}]},"7":{"loc":{"start":{"line":92,"column":2},"end":{"line":103,"column":3}},"type":"switch","locations":[{"start":{"line":93,"column":4},"end":{"line":93,"column":37}},{"start":{"line":94,"column":4},"end":{"line":94,"column":35}},{"start":{"line":95,"column":4},"end":{"line":95,"column":37}},{"start":{"line":96,"column":4},"end":{"line":96,"column":35}},{"start":{"line":97,"column":4},"end":{"line":98,"column":13}},{"start":{"line":99,"column":4},"end":{"line":102,"column":8}}]}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0},"b":{"0":[0,0],"1":[0],"2":[0],"3":[0,0],"4":[0],"5":[0,0],"6":[0],"7":[0,0,0,0,0,0]}}
,"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\designated-accounts\\types.ts": {"path":"C:\\src\\APGMS-Final\\packages\\domain-policy\\src\\designated-accounts\\types.ts","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":3,"column":null}},"1":{"start":{"line":4,"column":2},"end":{"line":4,"column":null}},"2":{"start":{"line":5,"column":2},"end":{"line":5,"column":null}},"3":{"start":{"line":6,"column":2},"end":{"line":6,"column":null}},"4":{"start":{"line":7,"column":2},"end":{"line":7,"column":null}},"5":{"start":{"line":8,"column":2},"end":{"line":8,"column":null}},"6":{"start":{"line":11,"column":0},"end":{"line":11,"column":null}},"7":{"start":{"line":12,"column":2},"end":{"line":12,"column":null}},"8":{"start":{"line":13,"column":2},"end":{"line":13,"column":null}},"9":{"start":{"line":14,"column":2},"end":{"line":14,"column":null}},"10":{"start":{"line":15,"column":2},"end":{"line":15,"column":null}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":3,"column":0},"end":{"line":3,"column":6}},"loc":{"start":{"line":3,"column":33},"end":{"line":9,"column":1}}},"1":{"name":"(anonymous_1)","decl":{"start":{"line":11,"column":0},"end":{"line":11,"column":6}},"loc":{"start":{"line":11,"column":38},"end":{"line":16,"column":1}}}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":12},"end":{"line":3,"column":null}},"type":"binary-expr","locations":[{"start":{"line":3,"column":12},"end":{"line":3,"column":33}},{"start":{"line":3,"column":12},"end":{"line":3,"column":null}}]},"1":{"loc":{"start":{"line":11,"column":12},"end":{"line":11,"column":null}},"type":"binary-expr","locations":[{"start":{"line":11,"column":12},"end":{"line":11,"column":38}},{"start":{"line":11,"column":12},"end":{"line":11,"column":null}}]}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"f":{"0":0,"1":0},"b":{"0":[0,0],"1":[0,0]}}
,"C:\\src\\APGMS-Final\\packages\\ledger\\src\\journalWriter.ts": {"path":"C:\\src\\APGMS-Final\\packages\\ledger\\src\\journalWriter.ts","statementMap":{"0":{"start":{"line":1,"column":0},"end":{"line":1,"column":41}},"1":{"start":{"line":41,"column":31},"end":{"line":41,"column":58}},"2":{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},"3":{"start":{"line":45,"column":6},"end":{"line":45,"column":80}},"4":{"start":{"line":48,"column":18},"end":{"line":50,"column":null}},"5":{"start":{"line":49,"column":24},"end":{"line":49,"column":57}},"6":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"7":{"start":{"line":54,"column":6},"end":{"line":54,"column":80}},"8":{"start":{"line":57,"column":19},"end":{"line":106,"column":6}},"9":{"start":{"line":58,"column":19},"end":{"line":62,"column":8}},"10":{"start":{"line":64,"column":22},"end":{"line":64,"column":58}},"11":{"start":{"line":65,"column":23},"end":{"line":65,"column":41}},"12":{"start":{"line":66,"column":19},"end":{"line":66,"column":47}},"13":{"start":{"line":68,"column":6},"end":{"line":105,"column":7}},"14":{"start":{"line":69,"column":31},"end":{"line":91,"column":10}},"15":{"start":{"line":82,"column":55},"end":{"line":87,"column":16}},"16":{"start":{"line":93,"column":8},"end":{"line":93,"column":58}},"17":{"start":{"line":95,"column":8},"end":{"line":103,"column":9}},"18":{"start":{"line":96,"column":27},"end":{"line":99,"column":12}},"19":{"start":{"line":100,"column":10},"end":{"line":102,"column":11}},"20":{"start":{"line":101,"column":12},"end":{"line":101,"column":57}},"21":{"start":{"line":104,"column":8},"end":{"line":104,"column":20}},"22":{"start":{"line":108,"column":4},"end":{"line":108,"column":18}},"23":{"start":{"line":40,"column":0},"end":{"line":40,"column":13}},"24":{"start":{"line":114,"column":4},"end":{"line":114,"column":19}},"25":{"start":{"line":115,"column":4},"end":{"line":115,"column":41}},"26":{"start":{"line":112,"column":0},"end":{"line":112,"column":13}},"27":{"start":{"line":120,"column":17},"end":{"line":120,"column":37}},"28":{"start":{"line":122,"column":2},"end":{"line":124,"column":3}},"29":{"start":{"line":123,"column":4},"end":{"line":123,"column":28}},"30":{"start":{"line":126,"column":2},"end":{"line":126,"column":29}},"31":{"start":{"line":127,"column":2},"end":{"line":127,"column":31}},"32":{"start":{"line":128,"column":2},"end":{"line":128,"column":32}},"33":{"start":{"line":129,"column":2},"end":{"line":129,"column":28}},"34":{"start":{"line":130,"column":2},"end":{"line":130,"column":48}},"35":{"start":{"line":131,"column":2},"end":{"line":131,"column":30}},"36":{"start":{"line":133,"column":2},"end":{"line":137,"column":3}},"37":{"start":{"line":134,"column":4},"end":{"line":134,"column":37}},"38":{"start":{"line":135,"column":4},"end":{"line":135,"column":58}},"39":{"start":{"line":136,"column":4},"end":{"line":136,"column":38}},"40":{"start":{"line":139,"column":2},"end":{"line":139,"column":30}},"41":{"start":{"line":143,"column":20},"end":{"line":143,"column":58}},"42":{"start":{"line":144,"column":2},"end":{"line":144,"column":37}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":41,"column":2},"end":{"line":41,"column":31}},"loc":{"start":{"line":41,"column":58},"end":{"line":41,"column":62}}},"1":{"name":"(anonymous_1)","decl":{"start":{"line":43,"column":2},"end":{"line":43,"column":7}},"loc":{"start":{"line":43,"column":38},"end":{"line":109,"column":3}}},"2":{"name":"(anonymous_2)","decl":{"start":{"line":49,"column":6},"end":{"line":49,"column":7}},"loc":{"start":{"line":49,"column":24},"end":{"line":49,"column":57}}},"3":{"name":"(anonymous_3)","decl":{"start":{"line":57,"column":50},"end":{"line":57,"column":55}},"loc":{"start":{"line":57,"column":63},"end":{"line":106,"column":5}}},"4":{"name":"(anonymous_4)","decl":{"start":{"line":82,"column":41},"end":{"line":82,"column":42}},"loc":{"start":{"line":82,"column":55},"end":{"line":87,"column":16}}},"5":{"name":"(anonymous_5)","decl":{"start":{"line":113,"column":2},"end":{"line":113,"column":14}},"loc":{"start":{"line":113,"column":29},"end":{"line":116,"column":3}}},"6":{"name":"computeHash","decl":{"start":{"line":119,"column":9},"end":{"line":119,"column":20}},"loc":{"start":{"line":119,"column":70},"end":{"line":140,"column":1}}},"7":{"name":"isUniqueViolation","decl":{"start":{"line":142,"column":9},"end":{"line":142,"column":26}},"loc":{"start":{"line":142,"column":41},"end":{"line":145,"column":1}}}},"branchMap":{"0":{"loc":{"start":{"line":44,"column":4},"end":{"line":46,"column":5}},"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":46,"column":5}}]},"1":{"loc":{"start":{"line":53,"column":4},"end":{"line":55,"column":5}},"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":55,"column":5}}]},"2":{"loc":{"start":{"line":64,"column":23},"end":{"line":64,"column":45}},"type":"binary-expr","locations":[{"start":{"line":64,"column":23},"end":{"line":64,"column":32}},{"start":{"line":64,"column":36},"end":{"line":64,"column":45}}]},"3":{"loc":{"start":{"line":65,"column":23},"end":{"line":65,"column":41}},"type":"binary-expr","locations":[{"start":{"line":65,"column":23},"end":{"line":65,"column":33}},{"start":{"line":65,"column":37},"end":{"line":65,"column":41}}]},"4":{"loc":{"start":{"line":95,"column":8},"end":{"line":103,"column":9}},"type":"if","locations":[{"start":{"line":95,"column":8},"end":{"line":103,"column":9}}]},"5":{"loc":{"start":{"line":100,"column":10},"end":{"line":102,"column":11}},"type":"if","locations":[{"start":{"line":100,"column":10},"end":{"line":102,"column":11}}]},"6":{"loc":{"start":{"line":122,"column":2},"end":{"line":124,"column":3}},"type":"if","locations":[{"start":{"line":122,"column":2},"end":{"line":124,"column":3}}]},"7":{"loc":{"start":{"line":136,"column":18},"end":{"line":136,"column":36}},"type":"binary-expr","locations":[{"start":{"line":136,"column":18},"end":{"line":136,"column":30}},{"start":{"line":136,"column":34},"end":{"line":136,"column":36}}]}},"s":{"0":1,"1":3,"2":5,"3":0,"4":5,"5":10,"6":5,"7":1,"8":4,"9":4,"10":4,"11":4,"12":4,"13":4,"14":4,"15":8,"16":3,"17":1,"18":1,"19":1,"20":1,"21":0,"22":4,"23":1,"24":1,"25":1,"26":1,"27":4,"28":4,"29":2,"30":4,"31":4,"32":4,"33":4,"34":4,"35":4,"36":4,"37":8,"38":8,"39":8,"40":4,"41":1,"42":1},"f":{"0":3,"1":5,"2":10,"3":4,"4":8,"5":1,"6":4,"7":1},"b":{"0":[0],"1":[1],"2":[4,2],"3":[4,2],"4":[1],"5":[1],"6":[2],"7":[8,8]}}
}



============================================================
FILE: C:\src\apgms-final\coverage\lcov-report\base.css
============================================================
body, html {
  margin:0; padding: 0;
  height: 100%;
}
body {
    font-family: Helvetica Neue, Helvetica, Arial;
    font-size: 14px;
    color:#333;
}
.small { font-size: 12px; }
*, *:after, *:before {
  -webkit-box-sizing:border-box;
     -moz-box-sizing:border-box;
          box-sizing:border-box;
  }
h1 { font-size: 20px; margin: 0;}
h2 { font-size: 14px; }
pre {
    font: 12px/1.4 Consolas, "Liberation Mono", Menlo, Courier, monospace;
    margin: 0;
    padding: 0;
    -moz-tab-size: 2;
    -o-tab-size:  2;
    tab-size: 2;
}
a { color:#0074D9; text-decoration:none; }
a:hover { text-decoration:underline; }
.strong { font-weight: bold; }
.space-top1 { padding: 10px 0 0 0; }
.pad2y { padding: 20px 0; }
.pad1y { padding: 10px 0; }
.pad2x { padding: 0 20px; }
.pad2 { padding: 20px; }
.pad1 { padding: 10px; }
.space-left2 { padding-left:55px; }
.space-right2 { padding-right:20px; }
.center { text-align:center; }
.clearfix { display:block; }
.clearfix:after {
  content:'';
  display:block;
  height:0;
  clear:both;
  visibility:hidden;
  }
.fl { float: left; }
@media only screen and (max-width:640px) {
  .col3 { width:100%; max-width:100%; }
  .hide-mobile { display:none!important; }
}

.quiet {
  color: #7f7f7f;
  color: rgba(0,0,0,0.5);
}
.quiet a { opacity: 0.7; }

.fraction {
  font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace;
  font-size: 10px;
  color: #555;
  background: #E8E8E8;
  padding: 4px 5px;
  border-radius: 3px;
  vertical-align: middle;
}

div.path a:link, div.path a:visited { color: #333; }
table.coverage {
  border-collapse: collapse;
  margin: 10px 0 0 0;
  padding: 0;
}

table.coverage td {
  margin: 0;
  padding: 0;
  vertical-align: top;
}
table.coverage td.line-count {
    text-align: right;
    padding: 0 5px 0 20px;
}
table.coverage td.line-coverage {
    text-align: right;
    padding-right: 10px;
    min-width:20px;
}

table.coverage td span.cline-any {
    display: inline-block;
    padding: 0 5px;
    width: 100%;
}
.missing-if-branch {
    display: inline-block;
    margin-right: 5px;
    border-radius: 3px;
    position: relative;
    padding: 0 4px;
    background: #333;
    color: yellow;
}

.skip-if-branch {
    display: none;
    margin-right: 10px;
    position: relative;
    padding: 0 4px;
    background: #ccc;
    color: white;
}
.missing-if-branch .typ, .skip-if-branch .typ {
    color: inherit !important;
}
.coverage-summary {
  border-collapse: collapse;
  width: 100%;
}
.coverage-summary tr { border-bottom: 1px solid #bbb; }
.keyline-all { border: 1px solid #ddd; }
.coverage-summary td, .coverage-summary th { padding: 10px; }
.coverage-summary tbody { border: 1px solid #bbb; }
.coverage-summary td { border-right: 1px solid #bbb; }
.coverage-summary td:last-child { border-right: none; }
.coverage-summary th {
  text-align: left;
  font-weight: normal;
  white-space: nowrap;
}
.coverage-summary th.file { border-right: none !important; }
.coverage-summary th.pct { }
.coverage-summary th.pic,
.coverage-summary th.abs,
.coverage-summary td.pct,
.coverage-summary td.abs { text-align: right; }
.coverage-summary td.file { white-space: nowrap;  }
.coverage-summary td.pic { min-width: 120px !important;  }
.coverage-summary tfoot td { }

.coverage-summary .sorter {
    height: 10px;
    width: 7px;
    display: inline-block;
    margin-left: 0.5em;
    background: url(sort-arrow-sprite.png) no-repeat scroll 0 0 transparent;
}
.coverage-summary .sorted .sorter {
    background-position: 0 -20px;
}
.coverage-summary .sorted-desc .sorter {
    background-position: 0 -10px;
}
.status-line {  height: 10px; }
/* yellow */
.cbranch-no { background: yellow !important; color: #111; }
/* dark red */
.red.solid, .status-line.low, .low .cover-fill { background:#C21F39 }
.low .chart { border:1px solid #C21F39 }
.highlighted,
.highlighted .cstat-no, .highlighted .fstat-no, .highlighted .cbranch-no{
  background: #C21F39 !important;
}
/* medium red */
.cstat-no, .fstat-no, .cbranch-no, .cbranch-no { background:#F6C6CE }
/* light red */
.low, .cline-no { background:#FCE1E5 }
/* light green */
.high, .cline-yes { background:rgb(230,245,208) }
/* medium green */
.cstat-yes { background:rgb(161,215,106) }
/* dark green */
.status-line.high, .high .cover-fill { background:rgb(77,146,33) }
.high .chart { border:1px solid rgb(77,146,33) }
/* dark yellow (gold) */
.status-line.medium, .medium .cover-fill { background: #f9cd0b; }
.medium .chart { border:1px solid #f9cd0b; }
/* light yellow */
.medium { background: #fff4c2; }

.cstat-skip { background: #ddd; color: #111; }
.fstat-skip { background: #ddd; color: #111 !important; }
.cbranch-skip { background: #ddd !important; color: #111; }

span.cline-neutral { background: #eaeaea; }

.coverage-summary td.empty {
    opacity: .5;
    padding-top: 4px;
    padding-bottom: 4px;
    line-height: 1;
    color: #888;
}

.cover-fill, .cover-empty {
  display:inline-block;
  height: 12px;
}
.chart {
  line-height: 0;
}
.cover-empty {
    background: white;
}
.cover-full {
    border-right: none !important;
}
pre.prettyprint {
    border: none !important;
    padding: 0 !important;
    margin: 0 !important;
}
.com { color: #999 !important; }
.ignore-none { color: #999; font-weight: normal; }

.wrapper {
  min-height: 100%;
  height: auto !important;
  height: 100%;
  margin: 0 auto -48px;
}
.footer, .push {
  height: 48px;
}



============================================================
FILE: C:\src\apgms-final\coverage\lcov-report\block-navigation.js
============================================================
/* eslint-disable */
var jumpToCode = (function init() {
    // Classes of code we would like to highlight in the file view
    var missingCoverageClasses = ['.cbranch-no', '.cstat-no', '.fstat-no'];

    // Elements to highlight in the file listing view
    var fileListingElements = ['td.pct.low'];

    // We don't want to select elements that are direct descendants of another match
    var notSelector = ':not(' + missingCoverageClasses.join('):not(') + ') > '; // becomes `:not(a):not(b) > `

    // Selector that finds elements on the page to which we can jump
    var selector =
        fileListingElements.join(', ') +
        ', ' +
        notSelector +
        missingCoverageClasses.join(', ' + notSelector); // becomes `:not(a):not(b) > a, :not(a):not(b) > b`

    // The NodeList of matching elements
    var missingCoverageElements = document.querySelectorAll(selector);

    var currentIndex;

    function toggleClass(index) {
        missingCoverageElements
            .item(currentIndex)
            .classList.remove('highlighted');
        missingCoverageElements.item(index).classList.add('highlighted');
    }

    function makeCurrent(index) {
        toggleClass(index);
        currentIndex = index;
        missingCoverageElements.item(index).scrollIntoView({
            behavior: 'smooth',
            block: 'center',
            inline: 'center'
        });
    }

    function goToPrevious() {
        var nextIndex = 0;
        if (typeof currentIndex !== 'number' || currentIndex === 0) {
            nextIndex = missingCoverageElements.length - 1;
        } else if (missingCoverageElements.length > 1) {
            nextIndex = currentIndex - 1;
        }

        makeCurrent(nextIndex);
    }

    function goToNext() {
        var nextIndex = 0;

        if (
            typeof currentIndex === 'number' &&
            currentIndex < missingCoverageElements.length - 1
        ) {
            nextIndex = currentIndex + 1;
        }

        makeCurrent(nextIndex);
    }

    return function jump(event) {
        if (
            document.getElementById('fileSearch') === document.activeElement &&
            document.activeElement != null
        ) {
            // if we're currently focused on the search input, we don't want to navigate
            return;
        }

        switch (event.which) {
            case 78: // n
            case 74: // j
                goToNext();
                break;
            case 66: // b
            case 75: // k
            case 80: // p
                goToPrevious();
                break;
        }
    };
})();
window.addEventListener('keydown', jumpToCode);



============================================================
FILE: C:\src\apgms-final\coverage\lcov-report\domain-policy\src\au-tax\index.html
============================================================

<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for domain-policy/src/au-tax</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> domain-policy/src/au-tax</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/35</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/8</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/8</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/34</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <div class="pad1">
<table class="coverage-summary">
<thead>
<tr>
   <th data-col="file" data-fmt="html" data-html="true" class="file">File</th>
   <th data-col="pic" data-type="number" data-fmt="html" data-html="true" class="pic"></th>
   <th data-col="statements" data-type="number" data-fmt="pct" class="pct">Statements</th>
   <th data-col="statements_raw" data-type="number" data-fmt="html" class="abs"></th>
   <th data-col="branches" data-type="number" data-fmt="pct" class="pct">Branches</th>
   <th data-col="branches_raw" data-type="number" data-fmt="html" class="abs"></th>
   <th data-col="functions" data-type="number" data-fmt="pct" class="pct">Functions</th>
   <th data-col="functions_raw" data-type="number" data-fmt="html" class="abs"></th>
   <th data-col="lines" data-type="number" data-fmt="pct" class="pct">Lines</th>
   <th data-col="lines_raw" data-type="number" data-fmt="html" class="abs"></th>
</tr>
</thead>
<tbody><tr>
	<td class="file low" data-value="paygw-engine.ts"><a href="paygw-engine.ts.html">paygw-engine.ts</a></td>
	<td data-value="0" class="pic low">
	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
	</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="25" class="abs low">0/25</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="6" class="abs low">0/6</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="5" class="abs low">0/5</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="24" class="abs low">0/24</td>
	</tr>

<tr>
	<td class="file low" data-value="prisma-repository.ts"><a href="prisma-repository.ts.html">prisma-repository.ts</a></td>
	<td data-value="0" class="pic low">
	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
	</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="3" class="abs low">0/3</td>
	<td data-value="100" class="pct high">100%</td>
	<td data-value="0" class="abs high">0/0</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="2" class="abs low">0/2</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="3" class="abs low">0/3</td>
	</tr>

<tr>
	<td class="file low" data-value="types.ts"><a href="types.ts.html">types.ts</a></td>
	<td data-value="0" class="pic low">
	<div class="chart"><div class="cover-fill" style="width: 0%"></div><div class="cover-empty" style="width: 100%"></div></div>
	</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="7" class="abs low">0/7</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="2" class="abs low">0/2</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="1" class="abs low">0/1</td>
	<td data-value="0" class="pct low">0%</td>
	<td data-value="7" class="abs low">0/7</td>
	</tr>

</tbody>
</table>
</div>
                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-11-24T20:28:35.331Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    


============================================================
FILE: C:\src\apgms-final\coverage\lcov-report\domain-policy\src\au-tax\paygw-engine.ts.html
============================================================

<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for domain-policy/src/au-tax/paygw-engine.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">domain-policy/src/au-tax</a> paygw-engine.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/25</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/6</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/5</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/24</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a>
<a name='L71'></a><a href='#L71'>71</a>
<a name='L72'></a><a href='#L72'>72</a>
<a name='L73'></a><a href='#L73'>73</a>
<a name='L74'></a><a href='#L74'>74</a>
<a name='L75'></a><a href='#L75'>75</a>
<a name='L76'></a><a href='#L76'>76</a>
<a name='L77'></a><a href='#L77'>77</a>
<a name='L78'></a><a href='#L78'>78</a>
<a name='L79'></a><a href='#L79'>79</a>
<a name='L80'></a><a href='#L80'>80</a>
<a name='L81'></a><a href='#L81'>81</a>
<a name='L82'></a><a href='#L82'>82</a>
<a name='L83'></a><a href='#L83'>83</a>
<a name='L84'></a><a href='#L84'>84</a>
<a name='L85'></a><a href='#L85'>85</a>
<a name='L86'></a><a href='#L86'>86</a>
<a name='L87'></a><a href='#L87'>87</a>
<a name='L88'></a><a href='#L88'>88</a>
<a name='L89'></a><a href='#L89'>89</a>
<a name='L90'></a><a href='#L90'>90</a>
<a name='L91'></a><a href='#L91'>91</a>
<a name='L92'></a><a href='#L92'>92</a>
<a name='L93'></a><a href='#L93'>93</a>
<a name='L94'></a><a href='#L94'>94</a>
<a name='L95'></a><a href='#L95'>95</a>
<a name='L96'></a><a href='#L96'>96</a>
<a name='L97'></a><a href='#L97'>97</a>
<a name='L98'></a><a href='#L98'>98</a>
<a name='L99'></a><a href='#L99'>99</a>
<a name='L100'></a><a href='#L100'>100</a>
<a name='L101'></a><a href='#L101'>101</a>
<a name='L102'></a><a href='#L102'>102</a>
<a name='L103'></a><a href='#L103'>103</a>
<a name='L104'></a><a href='#L104'>104</a>
<a name='L105'></a><a href='#L105'>105</a>
<a name='L106'></a><a href='#L106'>106</a>
<a name='L107'></a><a href='#L107'>107</a>
<a name='L108'></a><a href='#L108'>108</a>
<a name='L109'></a><a href='#L109'>109</a>
<a name='L110'></a><a href='#L110'>110</a>
<a name='L111'></a><a href='#L111'>111</a>
<a name='L112'></a><a href='#L112'>112</a>
<a name='L113'></a><a href='#L113'>113</a>
<a name='L114'></a><a href='#L114'>114</a>
<a name='L115'></a><a href='#L115'>115</a>
<a name='L116'></a><a href='#L116'>116</a>
<a name='L117'></a><a href='#L117'>117</a>
<a name='L118'></a><a href='#L118'>118</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// packages/domain-policy/src/au-tax/paygw-engine.ts
&nbsp;
import {
  JurisdictionCode,
  PaygwBracket,
  PaygwConfig,
  TaxConfigRepository,
  TaxType,
} from "./types";
&nbsp;
export type PayPeriod =
  | "weekly"
  | "fortnightly"
  | "monthly"
  | "quarterly"
  | "annual";
&nbsp;
export interface PaygwCalculationInput {
  jurisdiction: JurisdictionCode; // "AU"
  paymentDate: Date;
  // Gross pay for the period in whole cents.
  grossCents: number;
  // Periodicity, used only to resolve the right AU tax table in data.
  payPeriod: PayPeriod;
  // Optional flags for HELP/STSL etc. These must be interpreted via config flags.
  flags?: Record&lt;string, boolean | string | number | undefined&gt;;
}
&nbsp;
export interface PaygwCalculationResult {
  withholdingCents: number;
  // Trace of which bracket and parameter set was used.
  parameterSetId: string;
  bracketIndex: number;
}
&nbsp;
/**
 * AU PAYGW engine that is entirely driven by TaxParameterSet and
 * TaxRateSchedule rows in the database.
 *
 * No numeric rates or thresholds are hard-coded here.
 */
export class PaygwEngine {
<span class="fstat-no" title="function not covered" >  constructor(private readonly <span class="cstat-no" title="statement not covered" >c</span>onfigRepo: TaxConfigRepository)</span> {}
&nbsp;
<span class="fstat-no" title="function not covered" >  async </span>calculate(
    input: PaygwCalculationInput
  ): Promise&lt;PaygwCalculationResult&gt; {
    const { jurisdiction, paymentDate, grossCents } = <span class="cstat-no" title="statement not covered" >input;</span>
&nbsp;
    const config = <span class="cstat-no" title="statement not covered" >await this.configRepo.getActiveConfig({</span>
      jurisdiction,
      taxType: TaxType.PAYGW,
      onDate: paymentDate,
    });
&nbsp;
    const paygwConfig = <span class="cstat-no" title="statement not covered" >this.assertPaygwConfig(config);</span>
&nbsp;
    const bracketIndex = <span class="cstat-no" title="statement not covered" >this.findBracketIndex(</span>
      paygwConfig.brackets,
      grossCents
    );
&nbsp;
<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (bracketIndex &lt; 0) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error(</span>
        `No PAYGW bracket found for grossCents=${grossCents} in parameter set ${paygwConfig.meta.id}`
      );
    }
&nbsp;
    const bracket = <span class="cstat-no" title="statement not covered" >paygwConfig.brackets[bracketIndex];</span>
    const withholdingCents = <span class="cstat-no" title="statement not covered" >this.applyBracket(bracket, grossCents);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return {</span>
      withholdingCents,
      parameterSetId: paygwConfig.meta.id,
      bracketIndex,
    };
  }
&nbsp;
  private <span class="fstat-no" title="function not covered" >assertPaygwConfig(</span>config: unknown): PaygwConfig {
    const typed = <span class="cstat-no" title="statement not covered" >config as PaygwConfig;</span>
<span class="cstat-no" title="statement not covered" >    <span class="missing-if-branch" title="if path not taken" >I</span>if (!typed?.meta || !Array.isArray(typed.brackets)) {</span>
<span class="cstat-no" title="statement not covered" >      throw new Error("Invalid PAYGW config returned from repository");</span>
    }
<span class="cstat-no" title="statement not covered" >    return typed;</span>
  }
&nbsp;
  private <span class="fstat-no" title="function not covered" >findBracketIndex(</span>
    brackets: ReadonlyArray&lt;PaygwBracket&gt;,
    grossCents: number
  ): number {
    // Brackets are expected to be sorted ascending by thresholdCents.
    let index = <span class="cstat-no" title="statement not covered" >-1;</span>
<span class="cstat-no" title="statement not covered" >    for (let i = <span class="cstat-no" title="statement not covered" >0;</span> i &lt; brackets.length; i += 1) {</span>
<span class="cstat-no" title="statement not covered" >      if (grossCents &gt;= brackets[i].thresholdCents) {</span>
<span class="cstat-no" title="statement not covered" >        index = i;</span>
      } else {
<span class="cstat-no" title="statement not covered" >        break;</span>
      }
    }
<span class="cstat-no" title="statement not covered" >    return index;</span>
  }
&nbsp;
  private <span class="fstat-no" title="function not covered" >applyBracket(</span>bracket: PaygwBracket, grossCents: number): number {
    const excessCents = <span class="cstat-no" title="statement not covered" >Math.max(0, grossCents - bracket.thresholdCents);</span>
&nbsp;
    // milli-rate is rate * 1000, so divide by 1000 to obtain the fractional rate.
    const variableComponent = <span class="cstat-no" title="statement not covered" >Math.floor(</span>
      (excessCents * bracket.marginalRateMilli) / 1000
    );
&nbsp;
    const rawWithholding = <span class="cstat-no" title="statement not covered" >bracket.baseWithholdingCents + variableComponent;</span>
&nbsp;
    // ATO tables typically round to whole dollars in the published schedule, but
    // this should be reflected in the schedule itself, not hard-coded here.
<span class="cstat-no" title="statement not covered" >    return Math.max(0, rawWithholding);</span>
  }
}
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-11-24T20:28:35.331Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    


============================================================
FILE: C:\src\apgms-final\coverage\lcov-report\domain-policy\src\au-tax\prisma-repository.ts.html
============================================================

<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for domain-policy/src/au-tax/prisma-repository.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">domain-policy/src/au-tax</a> prisma-repository.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/3</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">100% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/0</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/2</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/3</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// packages/domain-policy/src/au-tax/prisma-repository.ts
&nbsp;
import type { PrismaClient } from "@prisma/client";
import type {
  AuTaxConfig,
  JurisdictionCode,
  TaxConfigRepository,
  TaxType,
} from "./types";
&nbsp;
/**
 * Temporary stub of TaxConfigRepository backed by Prisma.
 *
 * This is here so the domain-policy package compiles cleanly while
 * the actual Prisma schema for AU tax tables is being finalised.
 *
 * Once your Prisma models are settled (AuTaxParameterSet, AuTaxRateSchedule,
 * etc.), we can replace this with a real implementation that:
 *   - queries those tables
 *   - enforces non-overlapping effective windows
 *   - maps rows into PaygwConfig / GstConfig.
 */
export class PrismaTaxConfigRepository implements TaxConfigRepository {
  private readonly prisma: PrismaClient;
&nbsp;
<span class="fstat-no" title="function not covered" >  constructor(p</span>risma: PrismaClient) {
<span class="cstat-no" title="statement not covered" >    this.prisma = prisma;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  async </span>getActiveConfig(params: {
    jurisdiction: JurisdictionCode;
    taxType: TaxType;
    onDate: Date;
  }): Promise&lt;AuTaxConfig&gt; {
    // eslint-disable-next-line no-console
<span class="cstat-no" title="statement not covered" >    console.warn(</span>
      "[PrismaTaxConfigRepository] getActiveConfig called, but this is currently a stub. " +
        "Wire this up to your real Prisma models before using in production.",
      {
        jurisdiction: params.jurisdiction,
        taxType: params.taxType,
        onDate: params.onDate.toISOString(),
      }
    );
&nbsp;
<span class="cstat-no" title="statement not covered" >    throw new Error(</span>
      "PrismaTaxConfigRepository.getActiveConfig is not implemented for your Prisma schema yet."
    );
  }
}
&nbsp;</pre></td></tr></table></pre>

                <div class='push'></div><!-- for sticky footer -->
            </div><!-- /wrapper -->
            <div class='footer quiet pad2 space-top1 center small'>
                Code coverage generated by
                <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">istanbul</a>
                at 2025-11-24T20:28:35.331Z
            </div>
        <script src="../../../prettify.js"></script>
        <script>
            window.onload = function () {
                prettyPrint();
            };
        </script>
        <script src="../../../sorter.js"></script>
        <script src="../../../block-navigation.js"></script>
    </body>
</html>
    


============================================================
FILE: C:\src\apgms-final\coverage\lcov-report\domain-policy\src\au-tax\types.ts.html
============================================================

<!doctype html>
<html lang="en">

<head>
    <title>Code coverage report for domain-policy/src/au-tax/types.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../../../favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
    
<body>
<div class='wrapper'>
    <div class='pad1'>
        <h1><a href="../../../index.html">All files</a> / <a href="index.html">domain-policy/src/au-tax</a> types.ts</h1>
        <div class='clearfix'>
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Statements</span>
                <span class='fraction'>0/7</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Branches</span>
                <span class='fraction'>0/2</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Functions</span>
                <span class='fraction'>0/1</span>
            </div>
        
            
            <div class='fl pad1y space-right2'>
                <span class="strong">0% </span>
                <span class="quiet">Lines</span>
                <span class='fraction'>0/7</span>
            </div>
        
            
        </div>
        <p class="quiet">
            Press <em>n</em> or <em>j</em> to go to the next uncovered block, <em>b</em>, <em>p</em> or <em>k</em> for the previous block.
        </p>
        <template id="filterTemplate">
            <div class="quiet">
                Filter:
                <input type="search" id="fileSearch">
            </div>
        </template>
    </div>
    <div class='status-line low'></div>
    <pre><table class="coverage">
<tr><td class="line-count quiet"><a name='L1'></a><a href='#L1'>1</a>
<a name='L2'></a><a href='#L2'>2</a>
<a name='L3'></a><a href='#L3'>3</a>
<a name='L4'></a><a href='#L4'>4</a>
<a name='L5'></a><a href='#L5'>5</a>
<a name='L6'></a><a href='#L6'>6</a>
<a name='L7'></a><a href='#L7'>7</a>
<a name='L8'></a><a href='#L8'>8</a>
<a name='L9'></a><a href='#L9'>9</a>
<a name='L10'></a><a href='#L10'>10</a>
<a name='L11'></a><a href='#L11'>11</a>
<a name='L12'></a><a href='#L12'>12</a>
<a name='L13'></a><a href='#L13'>13</a>
<a name='L14'></a><a href='#L14'>14</a>
<a name='L15'></a><a href='#L15'>15</a>
<a name='L16'></a><a href='#L16'>16</a>
<a name='L17'></a><a href='#L17'>17</a>
<a name='L18'></a><a href='#L18'>18</a>
<a name='L19'></a><a href='#L19'>19</a>
<a name='L20'></a><a href='#L20'>20</a>
<a name='L21'></a><a href='#L21'>21</a>
<a name='L22'></a><a href='#L22'>22</a>
<a name='L23'></a><a href='#L23'>23</a>
<a name='L24'></a><a href='#L24'>24</a>
<a name='L25'></a><a href='#L25'>25</a>
<a name='L26'></a><a href='#L26'>26</a>
<a name='L27'></a><a href='#L27'>27</a>
<a name='L28'></a><a href='#L28'>28</a>
<a name='L29'></a><a href='#L29'>29</a>
<a name='L30'></a><a href='#L30'>30</a>
<a name='L31'></a><a href='#L31'>31</a>
<a name='L32'></a><a href='#L32'>32</a>
<a name='L33'></a><a href='#L33'>33</a>
<a name='L34'></a><a href='#L34'>34</a>
<a name='L35'></a><a href='#L35'>35</a>
<a name='L36'></a><a href='#L36'>36</a>
<a name='L37'></a><a href='#L37'>37</a>
<a name='L38'></a><a href='#L38'>38</a>
<a name='L39'></a><a href='#L39'>39</a>
<a name='L40'></a><a href='#L40'>40</a>
<a name='L41'></a><a href='#L41'>41</a>
<a name='L42'></a><a href='#L42'>42</a>
<a name='L43'></a><a href='#L43'>43</a>
<a name='L44'></a><a href='#L44'>44</a>
<a name='L45'></a><a href='#L45'>45</a>
<a name='L46'></a><a href='#L46'>46</a>
<a name='L47'></a><a href='#L47'>47</a>
<a name='L48'></a><a href='#L48'>48</a>
<a name='L49'></a><a href='#L49'>49</a>
<a name='L50'></a><a href='#L50'>50</a>
<a name='L51'></a><a href='#L51'>51</a>
<a name='L52'></a><a href='#L52'>52</a>
<a name='L53'></a><a href='#L53'>53</a>
<a name='L54'></a><a href='#L54'>54</a>
<a name='L55'></a><a href='#L55'>55</a>
<a name='L56'></a><a href='#L56'>56</a>
<a name='L57'></a><a href='#L57'>57</a>
<a name='L58'></a><a href='#L58'>58</a>
<a name='L59'></a><a href='#L59'>59</a>
<a name='L60'></a><a href='#L60'>60</a>
<a name='L61'></a><a href='#L61'>61</a>
<a name='L62'></a><a href='#L62'>62</a>
<a name='L63'></a><a href='#L63'>63</a>
<a name='L64'></a><a href='#L64'>64</a>
<a name='L65'></a><a href='#L65'>65</a>
<a name='L66'></a><a href='#L66'>66</a>
<a name='L67'></a><a href='#L67'>67</a>
<a name='L68'></a><a href='#L68'>68</a>
<a name='L69'></a><a href='#L69'>69</a>
<a name='L70'></a><a href='#L70'>70</a></td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// packages/domain-policy/src/au-tax/types.ts
&nbsp;
export type JurisdictionCode = "AU";
&nbsp;
<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >export </span>enum TaxType {</span>
<span class="cstat-no" title="statement not covered" >  PAYGW = "PAYGW",</span>
<span class="cstat-no" title="statement not covered" >  GST = "GST",</span>
<span class="cstat-no" title="statement not covered" >  PAYGI = "PAYGI",</span>
<span class="cstat-no" title="statement not covered" >  FBT = "FBT",</span>
<span class="cstat-no" title="statement not covered" >  COMPANY_TAX = "COMPANY_TAX",</span>
<span class="cstat-no" title="statement not covered" >  OTHER = "OTHER",</span>
}
&nbsp;
export interface TaxParameterSetMeta {
  id: string;
  jurisdiction: JurisdictionCode;
  taxType: TaxType;
  // Australian financial year, e.g. "2024-2025"
  financialYear: string;
  validFrom: Date;
  validTo: Date | null;
  description?: string;
  versionTag?: string;
}
&nbsp;
export interface PaygwBracket {
  // Threshold at and above which this bracket applies, in whole cents.
  thresholdCents: number;
  // Base withholding amount for this bracket, in whole cents (ATO style).
  baseWithholdingCents: number;
  // Marginal rate above the threshold, expressed in milli-rate (e.g. 325 = 32.5%).
  marginalRateMilli: number;
}
&nbsp;
export interface PaygwConfig {
  meta: TaxParameterSetMeta;
  brackets: ReadonlyArray&lt;PaygwBracket&gt;;
  // Optional additional AU flags, e.g. Medicare levy switches, STSL flags, etc.
  flags?: Record&lt;string, boolean | string | number&gt;;
}
&nbsp;
export interface GstConfig {
  meta: TaxParameterSetMeta;
  // Rate in basis points, e.g. 1000 = 10.00%
  gstRateBps: number;
  // Future extension: reduced rates, exemptions, etc.
  flags?: Record&lt;string, boolean | string | number&gt;;
}
&nbsp;
/**
 * Union view over AU tax config.
 * Engines should downcast based on taxType.
 */
export type AuTaxConfig = PaygwConfig | GstConfig;
&nbsp;
/**
 * Repository interface used by engines to load AU tax configuration.
