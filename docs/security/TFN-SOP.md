# TFN handling SOP

## Storage controls
- Tax File Numbers are normalised and tokenised using the salted HMAC routine in [`tokenizeTFN`](../../services/api-gateway/src/lib/pii.ts), ensuring only the opaque token is persisted.
- Raw TFNs are accepted in memory only for the duration of the request lifecycle. Downstream services interact with encrypted payloads generated by [`encryptPII`](../../services/api-gateway/src/lib/pii.ts).
- Decryption is restricted to audited administrator flows; every successful decrypt writes a structured event through the configured audit logger.

## Retention and rotation
- Tokenised TFNs are stored alongside the minimum metadata needed for reconciliation; no unhashed TFNs are kept at rest.
- Salt material and encryption keys are rotated per the KMS procedures referenced by the `TokenSaltProvider` and `KeyManagementService` interfaces. Rotation requires re-seeding the providers and validating Playwright accessibility and API regression suites before promoting.
- Quarterly reviews confirm that historical tokens still resolve correctly and that no raw TFNs are present in backups.

## Export and deletion runbook
1. Authenticate with the admin token and request `[GET /admin/export/:orgId](../../services/api-gateway/src/app.ts)` to gather a point-in-time extract before any destructive work.
2. Confirm the subject scope, then call `[DELETE /admin/delete/:orgId](../../services/api-gateway/src/app.ts)` to trigger the soft-delete transaction that removes user records, purges bank line references, and stores a tombstone for audit evidence.
3. Record the operation in the incident tracker, attach the export artefact, and verify via the API response that `status: "deleted"` is returned. Close by re-running the `pii` and admin deletion test suites to document evidence of the controls.
