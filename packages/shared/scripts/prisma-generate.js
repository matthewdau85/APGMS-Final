#;
Dockerfile;
monorepo;
build;
for ( / api - gateway; FROM; node)
    : 20;
AS;
build;
WORKDIR / app;
#;
We;
keep;
the;
Prisma;
checksum;
relax, but;
DO;
NOT;
skip;
prisma;
generate;
ENV;
NODE_ENV = production;
PRISMA_ENGINES_CHECKSUM_IGNORE_MISSING = 1;
#;
Enable;
corepack;
so;
pnpm;
works;
RUN;
corepack;
enable;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- - ;
1.;
Copy;
only;
manifest;
files;
first;
for (better; caching; of `pnpm install`)
    --;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- -
    COPY;
pnpm - workspace.yaml;
pnpm - lock.yaml;
package.json. / ;
Workspace;
package;
manifests(adjusted, to, your, actual, structure);
COPY;
shared / package.json. / shared / package.json;
COPY;
packages / domain - policy / package.json. / packages / domain - policy / package.json;
COPY;
services / api - gateway / package.json. / services / api - gateway / package.json;
COPY;
services / connectors / package.json. / services / connectors / package.json;
#;
Install;
dependencies;
for (the; whole; workspace)
    RUN;
pnpm;
install--;
frozen - lockfile;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- - ;
2.;
Now;
copy;
the;
full;
source;
tree;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- -
    COPY..--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- - ;
3.;
Build;
all;
workspace;
packages(same, idea, local, build);
#;
This;
ensures:  -  / shared,  / domain - policy,  / connectors;
are;
built;
 - Prisma;
client;
is;
generated in the;
container;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- -
    RUN;
pnpm - r;
build;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- - ;
4.;
Runtime;
image;
#;
We;
keep;
it;
simple;
and;
use;
pnpm;
to;
start;
the;
api - gateway;
package.--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
--;
-- -
    FROM;
node: 20 - slim;
AS;
runtime;
WORKDIR / app;
ENV;
NODE_ENV = production;
RUN;
corepack;
enable;
#;
Bring;
over;
node_modules;
and;
repo;
metadata;
COPY--;
from = build / app / node_modules. / node_modules;
COPY--;
from = build / app / package.json. / package.json;
COPY--;
from = build / app / pnpm - workspace.yaml. / pnpm - workspace.yaml;
#;
Bring;
over;
built;
services + packages;
needed;
at;
runtime;
COPY--;
from = build / app / services / api - gateway. / services / api - gateway;
COPY--;
from = build / app / shared. / shared;
COPY--;
from = build / app / packages. / packages;
#;
Expose;
whatever;
port;
api - gateway;
listens;
on;
EXPOSE;
8080;
#;
Use;
the;
package.json;
scripts;
for ( / api - gateway; (this, assumes, "start", is, defined, there, and, points, at, the, built, JS); CMD["pnpm", "--filter", "@apgms/api-gateway", "start"])
    ;
export {};
//# sourceMappingURL=prisma-generate.js.map