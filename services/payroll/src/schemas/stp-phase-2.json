{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://apgms.example.com/schemas/stp-phase-2.json",
  "title": "Single Touch Payroll Phase 2",
  "type": "object",
  "required": ["specification", "version", "metadata", "transmission", "payer", "payRun"],
  "properties": {
    "specification": { "const": "ATO-STP-PHASE-2" },
    "version": { "type": "string" },
    "metadata": {
      "type": "object",
      "required": ["generatedAt"],
      "properties": {
        "generatedAt": { "type": "string", "format": "date-time" }
      }
    },
    "transmission": {
      "type": "object",
      "required": ["id", "payerAbn", "branchNumber", "softwareId"],
      "properties": {
        "id": { "type": "string" },
        "payerAbn": { "type": "string", "pattern": "^[0-9]{11}$" },
        "branchNumber": { "type": "string", "pattern": "^[0-9]{1,3}$" },
        "softwareId": { "type": "string" }
      }
    },
    "payer": {
      "type": "object",
      "required": ["abn", "branchNumber", "contactName", "phone", "softwareId", "transmissionId"],
      "properties": {
        "abn": { "type": "string", "pattern": "^[0-9]{11}$" },
        "branchNumber": { "type": "string" },
        "contactName": { "type": "string" },
        "phone": { "type": "string" },
        "softwareId": { "type": "string" },
        "transmissionId": { "type": "string" }
      }
    },
    "payRun": {
      "type": "object",
      "required": ["id", "periodStart", "periodEnd", "paymentDate", "totals", "events"],
      "properties": {
        "id": { "type": "string" },
        "periodStart": { "type": "string", "format": "date" },
        "periodEnd": { "type": "string", "format": "date" },
        "paymentDate": { "type": "string", "format": "date" },
        "totals": {
          "type": "object",
          "required": ["gross", "taxWithheld", "superannuationGuarantee"],
          "properties": {
            "gross": { "type": "number" },
            "taxWithheld": { "type": "number" },
            "superannuationGuarantee": { "type": "number" }
          }
        },
        "bas": {
          "type": "object",
          "required": ["gstOnSales", "gstOnPurchases", "paygWithholding", "paygInstalment", "reportingPeriod"],
          "properties": {
            "gstOnSales": { "type": "number" },
            "gstOnPurchases": { "type": "number" },
            "paygWithholding": { "type": "number" },
            "paygInstalment": { "type": "number" },
            "reportingPeriod": { "type": "string" }
          }
        },
        "events": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["payrollId", "taxFileNumber", "givenName", "familyName", "dateOfBirth", "residentialAddress", "income"],
            "properties": {
              "payrollId": { "type": "string" },
              "taxFileNumber": { "type": "string", "pattern": "^[0-9]{8,9}$" },
              "givenName": { "type": "string" },
              "familyName": { "type": "string" },
              "dateOfBirth": { "type": "string", "format": "date" },
              "residentialAddress": {
                "type": "object",
                "required": ["line1", "suburb", "state", "postcode"],
                "properties": {
                  "line1": { "type": "string" },
                  "line2": { "type": "string" },
                  "suburb": { "type": "string" },
                  "state": { "type": "string", "minLength": 2, "maxLength": 3 },
                  "postcode": { "type": "string", "pattern": "^[0-9]{4}$" },
                  "countryCode": { "type": "string", "minLength": 3, "maxLength": 3 }
                }
              },
              "income": {
                "type": "object",
                "required": ["taxableGross", "taxWithheld", "superannuationGuarantee"],
                "properties": {
                  "taxableGross": { "type": "number" },
                  "taxWithheld": { "type": "number" },
                  "superannuationGuarantee": { "type": "number" },
                  "allowances": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["code", "description", "amount"],
                      "properties": {
                        "code": { "type": "string" },
                        "description": { "type": "string" },
                        "amount": { "type": "number" }
                      }
                    }
                  },
                  "deductions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["code", "description", "amount"],
                      "properties": {
                        "code": { "type": "string" },
                        "description": { "type": "string" },
                        "amount": { "type": "number" }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
